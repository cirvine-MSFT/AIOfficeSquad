# Agent: Mac (Backend Dev) — 2026-02-22T2217Z

## Task
Investigate and fix "New Session" crash in Electron app when SDK not connected.

## Work
1. **Root Cause Analysis:** `SquadClientWithPool` instantiated before `connect()` called in `initialize()`. When `connect()` failed, client object not cleaned up. Internal async handlers (reconnect timers, socket error events) could fire after catch block and crash main process.
2. **Implementation:**
   - `squad-runtime.ts`: Call `client.shutdown()` in catch block; nullify `this.client`, `eventBus`, `pipeline`, `monitor`
   - `squad-runtime.ts`: `createSession()` now awaits `_initPromise` before checking guards
   - `preload/index.ts`: Wrap all `ipcRenderer.invoke()` calls with `.catch()` for graceful error return
   - `useChat.ts`: Validate agentName before calling IPC

## Result
✅ All 13 E2E tests pass. Build clean. No crashes on "New Session" button.

## Pattern
Always clean up SDK resources in catch blocks — partially-constructed objects with internal event loops are a crash vector in Electron main process.

---
**Files Modified:** 3  
**Tests Passing:** 13/13 E2E  
**Status:** Complete
