# Orchestration: Mac (Backend Dev)

**Spawned:** 2026-02-22T20:14:00Z  
**Mode:** background  
**Task:** Fix 3 SDK integration bugs in squad-runtime.ts

## Mission

Fix critical bugs in `apps/desktop/src/main/squad-runtime.ts`:
1. Missing `connect()` call after SquadClientWithPool instantiation
2. Incorrect `sendMessage()` usage (should use `session.sendAndWait()`)
3. Wrong cleanup method (`close()` should be `shutdown()`)
4. Add ErrorBoundary + try/catch error handling

## Outcome

✅ **All 3 bugs fixed**  
✅ **Build clean:** 55 modules, 0 errors  
✅ **ErrorBoundary added** to renderer (prevents white-screen crashes)  
✅ **useChat error handling** added with try/catch around IPC invoke  

## Key Changes

- SquadRuntime.initialize(): Added `await client.connect()`
- SquadRuntime.createSession(): Store session objects in `Map<string, any>`
- SquadRuntime.sendMessage(): Route via `session.sendAndWait(prompt)` instead of client method
- SquadRuntime.cleanup(): Call `client.shutdown()` instead of `close()`
- ErrorBoundary.tsx: NEW component with error UI fallback
- useChat.createSession: Wrapped IPC invoke in try/catch
- main.tsx: Wrapped App with ErrorBoundary

## Verification

Build command: `cd apps/desktop && npx electron-vite build`  
Result: ✅ 55 modules, 0 errors

## Files Modified

- apps/desktop/src/main/squad-runtime.ts
- apps/desktop/src/renderer/hooks/useChat.ts
- apps/desktop/src/renderer/components/ErrorBoundary.tsx (NEW)
- apps/desktop/src/renderer/main.tsx

## Related

**Decision:** Documented in `.squad/decisions/mac-sdk-api-fixes.md`  
**Root Cause Analysis:** Casey diagnosed SDK API surface via inspection  
**Follow-up:** Blain wrote 34 regression tests (16 runtime + 18 IPC handlers)
