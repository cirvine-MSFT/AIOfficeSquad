# Session: SDK Crash Fix

**Date:** 2026-02-22T20:14:00Z  
**Agents:** Mac, Blain  
**Outcome:** SDK integration bugs fixed, 34 regression tests written, all 41 desktop tests passing

## Summary

Desktop app crashed on "New Session" due to 3 SDK integration bugs. Mac fixed bugs in squad-runtime.ts; Blain wrote comprehensive regression tests.

## Bugs Fixed

1. ✅ Missing `client.connect()` after SquadClientWithPool instantiation
2. ✅ Incorrect `client.sendMessage()` usage (should use `session.sendAndWait()`)
3. ✅ Wrong cleanup method (`close()` → `shutdown()`)
4. ✅ Added ErrorBoundary + try/catch to prevent white-screen crashes

## Test Coverage

- 16 squad-runtime lifecycle tests (Mac learned: session objects stored in Map)
- 18 IPC handler tests (Blain learned: test infrastructure for SDK mocks)
- All 41 tests passing (0 failures)

## Deliverables

- **Code:** squad-runtime.ts fixed, ErrorBoundary added, useChat error handling
- **Tests:** squad-runtime.test.ts + ipc-handlers.test.ts (34 tests)
- **Build:** 55 modules, 0 errors

## Related Decisions

- `.squad/decisions/mac-sdk-api-fixes.md`
- `.squad/decisions/blain-test-strategy.md`
